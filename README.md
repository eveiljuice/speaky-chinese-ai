# HanYu Ê±âËØ≠ ‚Äî Telegram Bot –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏ –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ

Telegram-–±–æ—Ç –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω–æ–≥–æ –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ —Å AI.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üé§ **–ì–æ–ª–æ—Å–æ–≤—ã–µ –¥–∏–∞–ª–æ–≥–∏** ‚Äî –≥–æ–≤–æ—Ä–∏—Ç–µ –Ω–∞ –∫–∏—Ç–∞–π—Å–∫–æ–º, –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –≥–æ–ª–æ—Å–æ–º
- üìù **–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** ‚Äî –ø–∏—à–∏—Ç–µ –∏–µ—Ä–æ–≥–ª–∏—Ñ–∞–º–∏, –ø–æ–ª—É—á–∞–π—Ç–µ –æ—Ç–≤–µ—Ç—ã
- ‚úèÔ∏è **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫** ‚Äî AI –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –≥—Ä–∞–º–º–∞—Ç–∏–∫—É –∏ –æ–±—ä—è—Å–Ω—è–µ—Ç –æ—à–∏–±–∫–∏
- üìö **HSK 1-3** ‚Äî —Å–ª–æ–≤–∞—Ä—å –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –≤–∞—à —É—Ä–æ–≤–µ–Ω—å
- üéØ **6 —Ç–µ–º** ‚Äî –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, –µ–¥–∞, —Ä–∞–±–æ—Ç–∞, –±—ã—Ç, —É—á—ë–±–∞, –∑–¥–æ—Ä–æ–≤—å–µ
- üìñ **–õ–∏—á–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –Ω–æ–≤—ã–µ —Å–ª–æ–≤–∞
- üë• **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞** ‚Äî –ø—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π, –ø–æ–ª—É—á–∞–π—Ç–µ Premium

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- Telegram Bot Token (–æ—Ç @BotFather)
- OpenAI API Key

### –®–∞–≥–∏

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone <repo-url>
cd speaky-chinese
```

2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

4. –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª:
```bash
cp .env.example .env
```

5. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ `.env`:
```env
BOT_TOKEN=your_telegram_bot_token
OPENAI_API_KEY=your_openai_api_key
ADMIN_IDS=123456789,987654321
```

6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
```bash
python -m bot.main
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
hanyu-bot/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (Pydantic)
‚îÇ   ‚îú‚îÄ‚îÄ handlers/            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.py         # /start, /help
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dialog.py        # –ì–æ–ª–æ—Å–æ–≤—ã–µ –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ topic.py         # /topic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py      # /settings, /level
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ premium.py       # /premium
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ referral.py      # /invite
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vocabulary.py    # /vocabulary
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.py         # /admin
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile.py       # –ü—Ä–æ—Ñ–∏–ª—å
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ callbacks.py     # Inline-–∫–Ω–æ–ø–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/           # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reply.py         # –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ inline.py        # Inline-–∫–Ω–æ–ø–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/         # Middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py          # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ subscription.py  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ throttling.py    # Rate limiting
‚îÇ   ‚îú‚îÄ‚îÄ services/            # –°–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ai.py            # OpenAI (Whisper, GPT, TTS)
‚îÇ   ‚îú‚îÄ‚îÄ database/            # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py      # SQLite –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py        # Dataclass –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repositories.py  # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ       ‚îî‚îÄ‚îÄ hsk.py           # HSK —Å–ª–æ–≤–∞—Ä–∏
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ hsk1.json            # HSK 1 (~150 —Å–ª–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ hsk2.json            # HSK 2 (~150 —Å–ª–æ–≤)
‚îÇ   ‚îî‚îÄ‚îÄ hsk3.json            # HSK 3 (~150 —Å–ª–æ–≤)
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

## –ö–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º |
| `/help` | –°–ø—Ä–∞–≤–∫–∞ |
| `/topic` | –í—ã–±—Ä–∞—Ç—å —Ç–µ–º—É –¥–∏–∞–ª–æ–≥–∞ |
| `/settings` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ |
| `/level` | –ò–∑–º–µ–Ω–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å HSK |
| `/premium` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ |
| `/invite` | –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ |
| `/vocabulary` | –í–∞—à —Å–ª–æ–≤–∞—Ä—å |
| `/admin` | –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) |

## –ü–æ–¥–ø–∏—Å–∫–∞

### Trial (3 –¥–Ω—è)
- –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º

### Free
- 20 —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π/–¥–µ–Ω—å
- 5 –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π/–¥–µ–Ω—å
- 50 —Å–ª–æ–≤ –≤ —Å–ª–æ–≤–∞—Ä–µ

### Premium (‚ÇΩ770/–º–µ—Å)
- –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

## API —Å—Ç–æ–∏–º–æ—Å—Ç—å

–ü—Ä–∏ 1000 —Å–æ–æ–±—â–µ–Ω–∏–π/–¥–µ–Ω—å:
- Whisper STT: ~$0.50/–¥–µ–Ω—å
- GPT-4o-mini: ~$0.15/–¥–µ–Ω—å
- TTS: ~$0.75/–¥–µ–Ω—å
- **–ò—Ç–æ–≥–æ: ~$1.40/–¥–µ–Ω—å ‚âà $42/–º–µ—Å**

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **aiogram 3.x** ‚Äî Telegram Bot Framework
- **SQLite + aiosqlite** ‚Äî –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **OpenAI API** ‚Äî Whisper, GPT-4o-mini, TTS
- **Pydantic** ‚Äî –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

## Deployment

### Railway (Production)

–ë–æ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ [Railway](https://railway.app) –≤ webhook —Ä–µ–∂–∏–º–µ.

**–í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `railway_start.py` ‚Äî –∑–∞–ø—É—Å–∫ –≤ webhook —Ä–µ–∂–∏–º–µ
- `Procfile` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Railway
- `railway.json` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ–ø–ª–æ—è (replicas=1)

**Env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Railway:**
```
BOT_TOKEN=...
OPENAI_API_KEY=...
ADMIN_IDS=...
TRIBUTE_API_KEY=...
TRIBUTE_PRODUCT_ID=...
TRIBUTE_PAYMENT_LINK=...
```

**Deploy:**
```bash
git push origin main  # Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç
railway logs -f       # –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
```

### Local Development

```bash
# Polling mode (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
python -m bot.main

# Webhook + Payment server (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π)
python start_all.py
```

## Troubleshooting

### ‚ùå "Conflict: terminated by other getUpdates"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –±–æ—Ç–∞ –∑–∞–ø—É—â–µ–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–Ω–∞ Railway: replicas > 1)

**–†–µ—à–µ–Ω–∏–µ:**
1. Railway Dashboard ‚Üí Settings ‚Üí Deploy ‚Üí **Replicas = 1**
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è webhook mode (`railway_start.py`)
3. –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: **[RAILWAY_FIX.md](./RAILWAY_FIX.md)**

**–ë—ã—Å—Ç—Ä—ã–π —Ñ–∏–∫—Å:**
```bash
python delete_webhook.py  # –£–¥–∞–ª–∏—Ç—å webhook
python check_webhook.py   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
```

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

- `check_webhook.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å webhook
- `delete_webhook.py` ‚Äî —É–¥–∞–ª–∏—Ç—å webhook
- `railway_start.py` ‚Äî –∑–∞–ø—É—Å–∫ –≤ webhook —Ä–µ–∂–∏–º–µ (–¥–ª—è Railway)
- `start_all.py` ‚Äî –∑–∞–ø—É—Å–∫ –±–æ—Ç + webhook —Å–µ—Ä–≤–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[AGENTS.md](./AGENTS.md)** ‚Äî —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –∫–æ–º–∞–Ω–¥—ã
- **[RAILWAY_FIX.md](./RAILWAY_FIX.md)** ‚Äî —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Railway –¥–µ–ø–ª–æ–µ–º

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
